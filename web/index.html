<!doctype html>
<html lang="id">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SnapFlux</title>
    <script src="/eel.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" href="style.css" />
</head>

<body>
    <script>
        // Apply sidebar state immediately to prevent flicker/transition on load
        if (localStorage.getItem("sidebarCollapsed") === "true") {
            document.body.classList.add("sidebar-collapsed");
        }
    </script>
    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <div class="logo">
                <img src="img/logo.png" alt="SnapFlux Logo" class="logo-image" />
                <div class="logo-text">
                    <h1>SnapFlux</h1>
                </div>
            </div>
            <button id="sidebar-toggle" class="sidebar-toggle-btn" onclick="toggleSidebar()">
                <i class="fas fa-chevron-left"></i>
            </button>
        </div>

        <nav class="sidebar-nav">
            <div class="nav-item active" onclick="showPage('dashboard')">
                <i class="fas fa-chart-simple"></i>
                <span>Dasbor</span>
            </div>
            <div class="nav-item" onclick="showPage('automation')">
                <i class="fas fa-bolt"></i>
                <span>Otomasi</span>
            </div>
            <div class="nav-item" onclick="showPage('results')">
                <i class="fas fa-file-lines"></i>
                <span>Hasil</span>
            </div>
            <div class="nav-item" onclick="showPage('settings')">
                <i class="fas fa-sliders"></i>
                <span>Pengaturan</span>
            </div>
            <div class="nav-item" onclick="showPage('about')">
                <i class="fas fa-info-circle"></i>
                <span>Tentang</span>
            </div>
        </nav>

        <div class="sidebar-footer">
            <div class="flex items-center gap-2 text-sm text-muted">
                <div class="account-status-indicator processing"></div>
                <span id="status-text">Siap</span>
            </div>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-wrapper">
        <!-- Header -->
        <header class="header">
            <div class="header-flex">
                <!-- Page Title with Icon -->
                <div class="page-title-wrapper">
                    <div>
                        <h2 class="page-title page-title-zero-margin" id="page-title">
                            Dasbor
                        </h2>
                        <p id="page-subtitle" class="page-subtitle">
                            Pantau performa otomasi secara realtime
                        </p>
                    </div>
                </div>
            </div>

            <!-- Right Side Info -->
            <div class="header-right">
                <!-- Current Time -->
                <div class="header-time-wrapper">
                    <div class="header-time-label">
                        Waktu Saat Ini
                    </div>
                    <div id="header-time" class="header-time-value">
                        --:--:--
                    </div>
                </div>
            </div>
        </header>

        <div class="container">
            <!-- DASHBOARD PAGE -->
            <section id="dashboard-page" class="page-section active">
                <!-- Main Stats -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="total-accounts">0</div>
                        <div class="stat-label">Total Akun</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="success-count" style="color: var(--success)">
                            0
                        </div>
                        <div class="stat-label">Berhasil</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="failed-count" style="color: var(--error)">
                            0
                        </div>
                        <div class="stat-label">Gagal</div>
                    </div>
                </div>

                <!-- Monitoring Dashboard -->
                <div class="dashboard-grid-2col">
                    <!-- Performance Metrics -->
                    <div class="card">
                        <h3 class="card-title">
                            <i class="fas fa-gauge-high card-icon-primary"></i>
                            Kinerja
                        </h3>
                        <div class="metrics-list">
                            <div class="metric-row">
                                <span class="metric-label">Tingkat Keberhasilan</span>
                                <span id="metric-success-rate" class="metric-value-success">0%</span>
                            </div>
                            <div class="metric-row">
                                <span class="metric-label">Waktu Proses Rata-rata</span>
                                <span id="metric-avg-time" class="metric-value-primary">0s</span>
                            </div>
                            <div class="metric-row">
                                <span class="metric-label">Durasi Sesi</span>
                                <span id="metric-session-duration" class="metric-value-bold">0s</span>
                            </div>
                            <div class="metric-row">
                                <span class="metric-label">Laju Proses</span>
                                <span id="metric-throughput" class="metric-value-bold">0/min</span>
                            </div>
                        </div>
                    </div>

                    <!-- Real-time Data Summary -->
                    <div class="card">
                        <h3 class="card-title">
                            <i class="fas fa-chart-line card-icon-primary"></i>
                            Ringkasan Data Real-time
                        </h3>
                        <div class="metrics-list">
                            <div class="metric-row">
                                <span class="metric-label">Total Penjualan (Input) </span>
                                <span id="metric-total-sales" class="metric-value-success">0</span>
                            </div>
                            <div class="metric-row">
                                <span class="metric-label">Total Stok Terpantau </span>
                                <span id="metric-total-stock" class="metric-value-primary">0</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Error Tracking (if errors exist) -->
                <div id="error-tracking" class="card error-card-margin">
                    <h3 class="card-title">
                        <i class="fas fa-triangle-exclamation card-icon-error"></i>
                        Error
                    </h3>
                    <div id="error-list" class="error-list">
                        <!-- Error items will be inserted here -->
                    </div>
                </div>
            </section>

            <!-- AUTOMATION PAGE -->
            <section id="automation-page" class="page-section">
                <div class="card mb-4">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="form-label form-group-zero-margin">
                            Kontrol Otomasi
                        </h3>
                        <div class="flex gap-2">
                            <button id="start-btn" class="btn btn-primary" onclick="startAutomation()">
                                <i class="fas fa-play"></i> Mulai
                            </button>
                            <button id="pause-btn" class="btn btn-secondary" onclick="pauseAutomation()" disabled>
                                <i class="fas fa-pause"></i> Jeda
                            </button>
                            <button id="stop-btn" class="btn btn-danger" onclick="stopAutomation()" disabled>
                                <i class="fas fa-stop"></i> Berhenti
                            </button>
                        </div>
                    </div>

                    <div class="automation-control-grid mb-4">
                        <div class="form-group form-group-zero-margin">
                            <label class="form-label">File Excel Akun</label>
                            <div class="flex items-center gap-2">
                                <input type="file" id="excel-file-input" accept=".xlsx, .xls" class="file-input-hidden"
                                    onchange="handleFileSelect(this)" />
                                <button class="btn btn-primary btn-sm"
                                    onclick="document.getElementById('excel-file-input').click()">
                                    <i class="fas fa-folder-open"></i> Pilih
                                    File
                                </button>
                                <span id="selected-filename" class="text-sm text-muted truncate filename-text">Belum ada
                                    file</span>
                            </div>
                        </div>
                        <div class="form-group form-group-zero-margin">
                            <label class="form-label">Filter Tanggal (Opsional)</label>
                            <div class="input-icon-wrapper">
                                <input type="date" id="date-filter" class="form-input" />
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Processing View (Prominent Card) -->
                <div id="processing-view" class="card mb-4 hidden processing-view-relative">
                    <!-- Background Status Indicator -->
                    <div class="processing-status-indicator"></div>

                    <div class="processing-content-padding">
                        <!-- Top Row: Status with animated badge -->
                        <div class="mb-4">
                            <div id="processing-status"
                                class="text-primary font-bold text-sm flex items-center gap-2 processing-status-badge">
                                <span class="processing-loader-xs"></span>
                                <span>Menunggu...</span>
                            </div>
                        </div>

                        <!-- Main Content Grid: Chart + Info -->
                        <div class="processing-main-grid">
                            <!-- Circular Progress Chart -->
                            <div class="processing-chart-wrapper">
                                <svg width="80" height="80" viewBox="0 0 80 80" class="processing-svg-rotate">
                                    <!-- Background Circle -->
                                    <circle cx="40" cy="40" r="34" fill="none" stroke="#e5e7eb" stroke-width="6">
                                    </circle>
                                    <!-- Progress Circle -->
                                    <circle id="processing-progress-circle" cx="40" cy="40" r="34" fill="none"
                                        stroke="url(#progressGradient)" stroke-width="6" stroke-dasharray="213.63"
                                        stroke-dashoffset="213.63" stroke-linecap="round"
                                        class="processing-circle-transition"></circle>
                                    <!-- Gradient Definition -->
                                    <defs>
                                        <linearGradient id="progressGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                            <stop offset="0%" style="
                                                        stop-color: #4a70a9;
                                                        stop-opacity: 1;
                                                    " />
                                            <stop offset="100%" style="
                                                        stop-color: #6366f1;
                                                        stop-opacity: 1;
                                                    " />
                                        </linearGradient>
                                    </defs>
                                </svg>
                                <!-- Percentage in center -->
                                <div class="processing-percent-center">
                                    <div id="processing-percent-chart" class="processing-percent-text">
                                        0%
                                    </div>
                                </div>
                            </div>

                            <!-- Account Info -->
                            <div class="processing-account-info">
                                <h2 id="processing-name" class="text-2xl font-bold text-main mb-1 processing-name">
                                    Memuat...
                                </h2>
                                <p id="processing-username" class="text-muted font-mono text-sm">
                                    ---
                                </p>
                                <div class="flex items-center gap-2 mt-2">
                                    <div class="processing-counter-badge">
                                        <i class="fas fa-list-ol processing-counter-icon"></i>
                                        <span class="processing-counter-text">
                                            <span id="processing-current">0</span>/<span id="processing-total">0</span>
                                        </span>
                                    </div>
                                </div>
                            </div>

                            <!-- Action Button -->
                            <div>
                                <button id="pause-btn-processing"
                                    class="btn btn-secondary btn-sm processing-action-button"
                                    onclick="pauseAutomation()">
                                    <i class="fas fa-pause"></i> Jeda
                                </button>
                            </div>
                        </div>

                        <!-- Bottom: Linear Progress Bar (subtle) -->
                        <div class="processing-progress-wrapper">
                            <div class="processing-progress-track">
                                <div id="processing-progress-fill" class="processing-progress-fill"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Account List Container -->
                <div class="card account-list-card">
                    <div class="card-header flex justify-between items-center mb-4">
                        <div class="empty-flex"></div>
                        <button id="select-all-btn" class="btn btn-primary text-sm select-all-btn-animated"
                            onclick="toggleSelectAll()">
                            <i class="fas fa-check-double"></i> Pilih Semua
                        </button>
                    </div>

                    <div id="accounts-list-view" class="account-scroll-container">
                        <div id="accounts-container" class="account-grid">
                            <!-- Accounts will be injected here -->
                            <div class="empty-state text-center py-8 text-muted">
                                <i class="fas fa-inbox text-4xl mb-2"></i>
                                <p>Belum ada akun dimuat</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- RESULTS PAGE -->
            <section id="results-page" class="page-section">
                <div class="card mb-4">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="form-label form-group-zero-margin">
                            Log Aktivitas
                        </h3>
                        <div class="flex gap-2">
                            <button class="btn btn-primary text-sm" onclick="saveResultsAs()">
                                <i class="fas fa-save"></i> Simpan
                            </button>
                            <button class="btn btn-secondary text-sm" onclick="clearLog()">
                                <i class="fas fa-trash"></i> Bersihkan
                            </button>
                        </div>
                    </div>
                    <div id="log-container" class="log-container">
                        <!-- Logs will appear here -->
                    </div>
                </div>

                <!-- Export Card (Hidden by default) -->
                <div id="export-card" class="card hidden text-center py-8">
                    <div class="mb-4">
                        <i class="fas fa-check-circle text-5xl text-green-500"></i>
                    </div>
                    <h3 class="text-2xl font-bold mb-2">
                        Automation Selesai!
                    </h3>
                </div>
            </section>

            <!-- SETTINGS PAGE -->
            <section id="settings-page" class="page-section">
                <!-- Page Header -->
                <div class="settings-header">
                    <h2 class="settings-title">
                        Pengaturan
                    </h2>
                    <p class="settings-subtitle">
                        Kelola preferensi dan konfigurasi aplikasi Anda
                    </p>
                </div>

                <!-- Browser Settings -->
                <div class="card settings-card-spacing">
                    <div class="settings-section-header">
                        <h3 class="settings-section-title">
                            Pengaturan Browser
                        </h3>
                        <p class="settings-section-desc">
                            Konfigurasi cara browser berjalan saat otomasi
                        </p>
                    </div>

                    <!-- Headless Mode Setting -->
                    <div class="settings-item-row">
                        <div class="settings-item-content">
                            <label class="settings-item-label">Headless Mode</label>
                            <p class="settings-item-desc">
                                Jalankan browser di background tanpa
                                tampilan visual. Lebih cepat dan hemat
                                resource.
                            </p>
                        </div>
                        <label class="toggle-wrapper settings-toggle-spacing">
                            <input type="checkbox" id="headless-toggle" class="toggle-checkbox"
                                onchange="toggleHeadless()" checked />
                            <div class="toggle-switch"></div>
                        </label>
                    </div>
                </div>

                <!-- Performance Settings -->
                <div class="card settings-card-spacing">
                    <div class="settings-section-header">
                        <h3 class="settings-section-title">
                            Pengaturan Performa
                        </h3>
                        <p class="settings-section-desc">
                            Atur timing dan delay untuk optimasi kecepatan
                        </p>
                    </div>

                    <!-- Delay Setting -->
                    <div class="settings-delay-row">
                        <label class="settings-item-label">Delay Antar Aksi</label>
                        <p class="settings-delay-desc">
                            Waktu jeda antar aksi untuk menghindari deteksi
                            bot. Nilai lebih tinggi = lebih aman tapi lebih
                            lambat.
                        </p>
                        <div class="settings-delay-controls">
                            <input type="number" id="delay-input" class="form-input settings-delay-input" value="2.0"
                                step="0.5" min="0.5" max="10" />
                            <span class="settings-delay-unit">detik</span>
                            <div class="settings-delay-buttons">
                                <button onclick="document.getElementById('delay-input').value = '0.5'"
                                    class="btn btn-secondary btn-sm settings-delay-button">
                                    Cepat (0.5s)
                                </button>
                                <button onclick="document.getElementById('delay-input').value = '2.0'"
                                    class="btn btn-secondary btn-sm settings-delay-button">
                                    Normal (2.0s)
                                </button>
                                <button onclick="document.getElementById('delay-input').value = '5.0'"
                                    class="btn btn-secondary btn-sm settings-delay-button">
                                    Aman (5.0s)
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Info Box -->
                <div class="settings-info-box">
                    <p class="settings-info-text">
                        <strong>Tips:</strong> Gunakan Headless Mode untuk
                        performa maksimal. Jika mengalami error, coba
                        nonaktifkan untuk melihat proses browser secara
                        visual.
                    </p>
                </div>
            </section>

            <!-- ABOUT PAGE -->
            <section id="about-page" class="page-section">
                <div class="card">
                    <h2 class="settings-title" style="margin-bottom: 1.5rem;">
                        Tentang SnapFlux
                    </h2>
                    <div style="color: var(--text-muted); line-height: 1.8;">
                        <div class="mb-6">
                            <h3 class="text-lg font-bold text-main mb-2">Apa itu SnapFlux?</h3>
                            <p>
                                SnapFlux adalah sistem otomasi cerdas yang dirancang khusus untuk PT.
                                MOYVERONIKA guna
                                mengelola dan memantau data pangkalan (MAP) secara efisien. Aplikasi ini
                                menggantikan
                                proses manual yang memakan waktu dengan solusi otomatis yang cepat dan
                                akurat.
                            </p>
                        </div>

                        <div class="mb-6">
                            <h3 class="text-lg font-bold text-main mb-2">Masalah yang Diatasi</h3>
                            <ul class="list-disc pl-5 space-y-1">
                                <li>Banyak pangkalan dikelola oleh orang tua yang kurang terbiasa dengan
                                    teknologi.</li>
                                <li>Kualitas jaringan sering lambat, sehingga akses website memakan waktu.
                                </li>
                                <li>Proses input dan pengecekan harus dilakukan satu per satu.</li>
                                <li>Setiap akun membutuhkan waktu 1 menit atau lebih untuk login, cek stok,
                                    mencatat,
                                    dan logout.</li>
                                <li>Untuk 100 akun, waktu pengecekan total bisa mencapai 2 jam lebih setiap
                                    hari.</li>
                                <li>Ketika pangkalan lupa input atau inputnya tidak lengkap, admin harus
                                    menghubungi
                                    ulang satu per satu.</li>
                                <li>Jika stok tidak diinput, perusahaan tidak bisa memonitor tingkat
                                    ketersediaan barang
                                    secara akurat, dan gas tidak dimasukan ke pangkalan kalau stok belum
                                    kosong.</li>
                            </ul>
                        </div>

                        <div class="mb-6">
                            <h3 class="text-lg font-bold text-main mb-2">Tujuan Pengembangan</h3>
                            <ul class="list-disc pl-5 space-y-1">
                                <li>Mengambil data otomatis dari 100 akun dalam satu kali proses, tanpa
                                    harus login
                                    manual.</li>
                                <li>Mempercepat waktu scraping dari 1 menit per akun menjadi < 15 detik per akun.</li>
                                <li>Menghemat lebih dari 80% waktu operasional setiap hari.</li>
                                <li>Mengurangi kesalahan input akibat proses manual.</li>
                                <li>Memudahkan analisis stok dan input dengan data yang terkumpul secara
                                    real-time.</li>
                                <li>Mengirim notifikasi/pengingat untuk pangkalan yang belum melakukan
                                    input, terutama
                                    jika stok masih tinggi (manual lewat Whatsapp).</li>
                                <li>Memberikan kemampuan bagi perusahaan untuk membantu input jika pangkalan
                                    terkendala
                                    jaringan.</li>
                                <li>Menghilangkan kebutuhan pindah-pindah tab, login satu-satu, dan
                                    pencatatan excel
                                    manual.</li>
                                <li>Memberikan sistem monitoring yang stabil dan dapat dijalankan oleh siapa
                                    saja.</li>
                            </ul>
                        </div>

                        <div class="mb-6">
                            <h3 class="text-lg font-bold text-main mb-2">Cara Kerja Singkat</h3>
                            <p>
                                SnapFlux bekerja dengan mensimulasikan interaksi pengguna pada browser
                                secara otomatis.
                                Sistem akan login ke setiap akun pangkalan yang terdaftar, mengambil data
                                stok dan
                                penjualan terkini, melakukan input data jika diperlukan, dan menyimpan semua
                                hasil ke
                                dalam laporan Excel yang rapi. Semua proses ini berjalan di latar belakang
                                (background)
                                atau terlihat (visible) sesuai pengaturan Anda.
                            </p>
                        </div>

                        <div class="mb-6">
                            <h3 class="text-lg font-bold text-main mb-2">Teknologi</h3>
                            <ul class="list-disc pl-5 space-y-1">
                                <li><strong>Backend:</strong> Python (Core Logic, Data Processing)</li>
                                <li><strong>Automation:</strong> Playwright (Browser Automation)</li>
                                <li><strong>Frontend:</strong> HTML, CSS, JavaScript (User Interface)</li>
                                <li><strong>Integration:</strong> Eel (Python-JS Bridge)</li>
                            </ul>
                        </div>

                        <div class="mb-6">
                            <h3 class="text-lg font-bold text-main mb-2">Keamanan dan Batasan</h3>
                            <p>
                                Aplikasi ini dikembangkan secara internal khusus untuk operasional
                                <strong>PT
                                    MOYVERONIKA</strong>. Data kredensial disimpan secara lokal di komputer
                                pengguna dan
                                tidak dikirim ke server eksternal manapun selain server resmi MAP saat
                                proses login.
                                Penggunaan aplikasi ini terbatas pada karyawan yang berwenang.
                            </p>
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <!-- Footer -->
        <footer class="footer-main">
            <div class="footer-grid">
                <!-- Left: About App -->
                <div>
                    <h3 class="footer-title">
                        SnapFlux
                    </h3>
                    <p class="footer-desc">
                        Sistem otomasi untuk MAP - PT. MOYVERONIKA
                    </p>
                    <div class="footer-tech-stack">
                        <span><strong>Built with:</strong> Python,
                            Playwright, Eel</span>
                    </div>
                </div>

                <!-- Center: Social Media -->
                <div class="footer-social-wrapper">
                    <p class="footer-social-title">
                        Connect with Me
                    </p>
                    <div class="footer-social-links">
                        <a href="https://github.com/ediiloupatty" target="_blank" rel="noopener noreferrer"
                            class="footer-social-link github" title="GitHub">
                            <i class="fab fa-github"></i>
                        </a>
                        <a href="https://www.instagram.com/ediloupatty/" target="_blank" rel="noopener noreferrer"
                            class="footer-social-link instagram" title="Instagram">
                            <i class="fab fa-instagram"></i>
                        </a>
                        <a href="https://www.kaggle.com/ediloupatty" target="_blank" rel="noopener noreferrer"
                            class="footer-social-link kaggle" title="Kaggle">
                            <i class="fab fa-kaggle"></i>
                        </a>
                        <a href="https://x.com/ediiiloupatty" target="_blank" rel="noopener noreferrer"
                            class="footer-social-link twitter" title="Twitter / X">
                            <i class="fab fa-x-twitter"></i>
                        </a>
                    </div>
                </div>

                <!-- Right: Copyright -->
                <div class="footer-copyright-wrapper">
                    <p class="footer-copyright-text">
                        <i class="far fa-copyright footer-copyright-icon"></i>
                        2024 Edi (22024169)
                    </p>
                    <p class="footer-rights">
                        All rights reserved.
                    </p>
                </div>
            </div>

            <!-- Bottom Bar -->
            <div class="footer-bottom-bar">
                <p class="footer-bottom-text">
                    Developed for educational and automation purposes | MIT
                    License
                </p>
            </div>
        </footer>
    </main>

    <script src="app.js"></script>
</body>

</html>